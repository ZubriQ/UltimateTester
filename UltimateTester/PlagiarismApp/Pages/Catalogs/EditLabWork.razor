@page "/lab_works/{id}"
@using Data.Database
@using Microsoft.Extensions.Logging
@using PlagiarismApp.Models
@inject LabWorkService LabWorkService
@inject NavigationManager NavigationManager
@attribute [Authorize]

<h3>Editing lab work: @labWorkModel.Name</h3>

<EditForm Model="@labWorkModel" OnValidSubmit="@UpdateLabWork">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Name:</label>
    </div>
    <div class="form-floating" style="margin:10px">
        <InputText id="name" @bind-Value="labWorkModel.Name" />
    </div>
    <div>
        <label>Description:</label>
    </div>
    <div class="form-floating" style="margin:10px">
        <InputText id="description" @bind-Value="labWorkModel.Description" />
    </div>
    <div class="form-floating" style="margin:10px">
        <button type="submit" class="btn btn-primary">Update</button>
    </div>

</EditForm>

@code {
    private LabWorkModel labWorkModel = new();

    private LabWork labWork = new();

    [Parameter]
    public string? Id { get; set; }

    protected async override Task OnInitializedAsync()
    {
        labWork = await LabWorkService.GetItemAsync(int.Parse(Id));
        labWorkModel.Name = labWork.Name;
        labWorkModel.Description = labWork.Description;
    }

    private void UpdateLabWork()
    {
        Edit();
        LabWorkService.Attach(labWork);
        LabWorkService.SaveChanges();
        NavigationManager.NavigateTo("/lab_works");
    }

    private void Edit()
    {
        labWork.Name = labWorkModel.Name;
        labWork.Description = labWorkModel.Description;
    }
}
